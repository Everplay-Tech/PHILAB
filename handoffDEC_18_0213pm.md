PhiLab Project Handoff                                                                                                                                                                                             
                                                                                                                                                                                                                     
  What This Is                                                                                                                                                                                                       
                                                                                                                                                                                                                     
  PhiLab is a toolkit for mapping the internal geometry of transformer language models, starting with Microsoft's Phi-2. The goal is to systematically document how concepts, relationships, and reasoning structures
   are represented in the model's residual stream and attention patterns.                                                                                                                                            
                                                                                                                                                                                                                     
  This is a community science project. The mapping work will be distributed across contributors via a task board system, with multiple people independently verifying each probe to ensure data quality.             
                                                                                                                                                                                                                     
  ---                                                                                                                                                                                                                
  Project Goals                                                                                                                                                                                                      
                                                                                                                                                                                                                     
  1. Map Phi-2 exhaustively — probe every layer for semantic relationships (synonyms, antonyms, hypernyms, etc.), epistemological structures (true/false geometry), and attention patterns                           
  2. Build a canonical dataset — verified, replicated probe results stored in a structured format                                                                                                                    
  3. Enable geometric algebra — once mapped, compare models (Phi-2 vs Phi-3), find morphisms, identify what's preserved vs novel across scale                                                                        
  4. Change the conversation — demonstrate how LLMs should be studied and understood, with an eye toward healthcare and beneficial applications                                                                      
                                                                                                                                                                                                                     
  ---                                                                                                                                                                                                                
  Repository Structure                                                                                                                                                                                               
                                                                                                                                                                                                                     
  phi2_lab/                                                                                                                                                                                                          
  ├── auth/                                                                                                                                                                                                          
  │   ├── __init__.py                                                                                                                                                                                                
  │   ├── api_keys.py          # API key validation logic                                                                                                                                                            
  │   └── API_ACCESS.md        # Documentation for auth system                                                                                                                                                       
  │                                                                                                                                                                                                                  
  ├── config/                                                                                                                                                                                                        
  │   ├── app.yaml             # Main config (model, atlas, telemetry settings)                                                                                                                                      
  │   └── environments/                                                                                                                                                                                              
  │       ├── development.yaml # Mock mode, CPU, relaxed settings                                                                                                                                                    
  │       ├── staging.yaml     # Real model, CPU                                                                                                                                                                     
  │       └── production.yaml  # Real model, GPU, optimized                                                                                                                                                          
  │                                                                                                                                                                                                                  
  ├── geometry_viz/                                                                                                                                                                                                  
  │   ├── api.py               # FastAPI router: /api/geometry/*                                                                                                                                                     
  │   ├── schema.py            # Pydantic models for all data structures                                                                                                                                             
  │   ├── mock_data.py         # Generates synthetic 32-layer telemetry                                                                                                                                              
  │   ├── telemetry_store.py   # File-based JSON storage for runs                                                                                                                                                    
  │   ├── residuals.py         # PCA computation for residual modes                                                                                                                                                  
  │   ├── residual_sampling.py # Sampling strategies for residual collection                                                                                                                                         
  │   ├── residual_metadata.py # Metadata handling                                                                                                                                                                   
  │   ├── recorder.py          # Telemetry recording utilities                                                                                                                                                       
  │   ├── integration.py       # Integration helpers                                                                                                                                                                 
  │   └── static/                                                                                                                                                                                                    
  │       ├── index.html       # Dashboard shell                                                                                                                                                                     
  │       ├── app2.js          # Frontend rendering logic                                                                                                                                                            
  │       └── styles.css       # Dark theme styling                                                                                                                                                                  
  │                                                                                                                                                                                                                  
  ├── phi2_core/                                                                                                                                                                                                     
  │   ├── config.py            # ModelConfig dataclass                                                                                                                                                               
  │   └── model_manager.py     # Singleton model loader (HuggingFace or mock)                                                                                                                                        
  │                                                                                                                                                                                                                  
  ├── phi2_atlas/                                                                                                                                                                                                    
  │   └── data/                                                                                                                                                                                                      
  │       └── atlas.db         # SQLite storage for atlas data                                                                                                                                                       
  │                                                                                                                                                                                                                  
  ├── models/                                                                                                                                                                                                        
  │   └── phi2/                                                                                                                                                                                                      
  │       └── architecture.py  # Static Phi-2 architecture metadata                                                                                                                                                  
  │                                                                                                                                                                                                                  
  ├── orchestration/                                                                                                                                                                                                 
  │   └── runner.py            # Experiment orchestration                                                                                                                                                            
  │                                                                                                                                                                                                                  
  ├── scripts/                                                                                                                                                                                                       
  │   ├── serve_geometry_dashboard.py  # Main entry point (uvicorn server)                                                                                                                                           
  │   ├── fetch_phi2_weights.py        # Download model from HuggingFace                                                                                                                                             
  │   ├── bootstrap_phi2.py            # Bootstrap model loading                                                                                                                                                     
  │   └── run_experiment.py            # Run probing experiments                                                                                                                                                     
  │                                                                                                                                                                                                                  
  └── experiments/                                                                                                                                                                                                   
      └── geometry/                                                                                                                                                                                                  
          └── run_probes.py    # Probe execution logic                                                                                                                                                               
                                                                                                                                                                                                                     
  ---                                                                                                                                                                                                                
  Data Schemas (Pydantic)                                                                                                                                                                                            
                                                                                                                                                                                                                     
  RunSummary — Top-level container for a probing run                                                                                                                                                                 
  - run_id, description, model_name, adapter_ids                                                                                                                                                                     
  - layers: List[LayerTelemetry]                                                                                                                                                                                     
  - timeline: List[RunTimelinePoint]                                                                                                                                                                                 
  - alignment_info: Optional[ModelAlignment]                                                                                                                                                                         
                                                                                                                                                                                                                     
  LayerTelemetry — Per-layer metrics                                                                                                                                                                                 
  - layer_index, adapter_id                                                                                                                                                                                          
  - adapter_weight_norm, effective_rank, delta_loss_estimate                                                                                                                                                         
  - residual_modes: List[ResidualMode]                                                                                                                                                                               
  - chart_atlases: List[ChartAtlas]                                                                                                                                                                                  
  - geodesic_paths: List[GeodesicPath]                                                                                                                                                                               
  - attention_sheaf: Optional[AttentionSheaf]                                                                                                                                                                        
                                                                                                                                                                                                                     
  ResidualMode — Principal direction in residual space                                                                                                                                                               
  - mode_index, eigenvalue, variance_explained                                                                                                                                                                       
  - token_examples, projection_coords                                                                                                                                                                                
  - span_across_layers, growth_curve, semantic_region                                                                                                                                                                
                                                                                                                                                                                                                     
  ChartAtlas — Coordinate patch on the manifold                                                                                                                                                                      
  - chart_type: PoincareDisk | Stereographic | AffinePatch                                                                                                                                                           
  - coordinates, metric_tensor, curvature_scalar                                                                                                                                                                     
                                                                                                                                                                                                                     
  GeodesicPath — Token trajectory through manifold                                                                                                                                                                   
  - token, layer_index, points, length, curvature_along_path                                                                                                                                                         
                                                                                                                                                                                                                     
  AttentionSheaf — Fiber bundle representation of attention                                                                                                                                                          
  - head_indices, base_space, stalks, restriction_maps                                                                                                                                                               
                                                                                                                                                                                                                     
  ModelAlignment — Cross-model comparison data                                                                                                                                                                       
  - source_model, target_model                                                                                                                                                                                       
  - layer_map, layer_scores                                                                                                                                                                                          
  - mode_map, mode_scores                                                                                                                                                                                            
  - residual_variety_points, explained_points                                                                                                                                                                        
                                                                                                                                                                                                                     
  ---                                                                                                                                                                                                                
  Authentication System                                                                                                                                                                                              
                                                                                                                                                                                                                     
  Open Access:                                                                                                                                                                                                       
  - Phi-2 requires no API key                                                                                                                                                                                        
  - Aliases: microsoft/phi-2, phi-2, phi2                                                                                                                                                                            
                                                                                                                                                                                                                     
  Restricted Models (require API key):                                                                                                                                                                               
  - Phi-3 variants                                                                                                                                                                                                   
  - Llama-2 variants                                                                                                                                                                                                 
  - Mistral variants                                                                                                                                                                                                 
                                                                                                                                                                                                                     
  API Key Methods:                                                                                                                                                                                                   
  1. Header: X-PhiLab-API-Key: <key>                                                                                                                                                                                 
  2. Query param: ?api_key=<key>                                                                                                                                                                                     
  3. Environment: PHILAB_API_KEY=<key>                                                                                                                                                                               
                                                                                                                                                                                                                     
  Environment Variables:                                                                                                                                                                                             
  - PHILAB_ALLOWED_KEYS — comma-separated valid keys                                                                                                                                                                 
  - PHILAB_ADMIN_KEYS — admin tier (higher rate limits)                                                                                                                                                              
                                                                                                                                                                                                                     
  ---                                                                                                                                                                                                                
  How to Run                                                                                                                                                                                                         
                                                                                                                                                                                                                     
  # Activate virtual environment                                                                                                                                                                                     
  source .venv/bin/activate                                                                                                                                                                                          
                                                                                                                                                                                                                     
  # Set Python path                                                                                                                                                                                                  
  export PYTHONPATH=/path/to/PHILAB_repo                                                                                                                                                                             
                                                                                                                                                                                                                     
  # Run with mock data (no GPU needed)                                                                                                                                                                               
  python phi2_lab/scripts/serve_geometry_dashboard.py --mock --port 8000                                                                                                                                             
                                                                                                                                                                                                                     
  # Run with real model                                                                                                                                                                                              
  python phi2_lab/scripts/serve_geometry_dashboard.py --port 8000                                                                                                                                                    
                                                                                                                                                                                                                     
  Server runs at http://127.0.0.1:8000                                                                                                                                                                               
                                                                                                                                                                                                                     
  API Endpoints:                                                                                                                                                                                                     
  - GET /api/geometry/models — list available models                                                                                                                                                                 
  - GET /api/geometry/runs — list telemetry runs                                                                                                                                                                     
  - GET /api/geometry/runs/{run_id} — get full run data                                                                                                                                                              
  - GET /api/geometry/runs/{run_id}/layers/{layer_index} — get layer data                                                                                                                                            
                                                                                                                                                                                                                     
  ---                                                                                                                                                                                                                
  Community Task System (Corkboard)                                                                                                                                                                                  
                                                                                                                                                                                                                     
  Concept: Distributed model mapping via community contributions                                                                                                                                                     
                                                                                                                                                                                                                     
  Task Types:                                                                                                                                                                                                        
  - Single layer probes                                                                                                                                                                                              
  - Multi-layer traces                                                                                                                                                                                               
  - Semantic relationship mapping (synonyms, antonyms, hypernyms, hyponyms, meronyms, holonyms, troponyms, etc.)                                                                                                     
  - Epistemological probes (true/false geometry)                                                                                                                                                                     
                                                                                                                                                                                                                     
  Verification:                                                                                                                                                                                                      
  - Each task claimed by 3-4 independent contributors                                                                                                                                                                
  - Results compared for consensus                                                                                                                                                                                   
  - Receipts include: task_id, seed, model config, output hash, timestamp                                                                                                                                            
  - Deterministic seeds ensure replicability                                                                                                                                                                         
                                                                                                                                                                                                                     
  Data Flow:                                                                                                                                                                                                         
  Task posted → Contributors claim → Run PhiLab locally → Submit receipt + results → Compare submissions → Verify → Merge to canonical dataset                                                                       
                                                                                                                                                                                                                     
  Platform: Reddit r/technopoets for coordination, Google Form for structured submissions, private spreadsheet for data aggregation                                                                                  
                                                                                                                                                                                                                     
  ---                                                                                                                                                                                                                
  Mock Data Generator                                                                                                                                                                                                
                                                                                                                                                                                                                     
  For development without GPU/model weights:                                                                                                                                                                         
                                                                                                                                                                                                                     
  - Generates 32 layers (matching Phi-2 architecture)                                                                                                                                                                
  - 3 residual modes per layer                                                                                                                                                                                       
  - 70% of modes have cross-model mappings                                                                                                                                                                           
  - 30% are "residual variety" (unique to model)                                                                                                                                                                     
  - Deterministic via seed (default: 1234)                                                                                                                                                                           
  - Produces realistic metric curves, PCA projections, geodesics                                                                                                                                                     
                                                                                                                                                                                                                     
  ---                                                                                                                                                                                                                
  What's Decided                                                                                                                                                                                                     
                                                                                                                                                                                                                     
  - Phi-2 as starting model (32 layers, 32 heads, 2560 hidden dim)                                                                                                                                                   
  - Pydantic for all schemas                                                                                                                                                                                         
  - YAML for config, JSON for data storage                                                                                                                                                                           
  - FastAPI backend                                                                                                                                                                                                  
  - SQLite for atlas storage                                                                                                                                                                                         
  - API key gating for non-Phi-2 models                                                                                                                                                                              
  - Community verification via redundant task completion                                                                                                                                                             
                                                                                                                                                                                                                     
  ---                                                                                                                                                                                                                
  What's Open                                                                                                                                                                                                        
                                                                                                                                                                                                                     
  - Final task template format for community probes                                                                                                                                                                  
  - Reddit vs custom site for task board                                                                                                                                                                             
  - Receipt schema finalization                                                                                                                                                                                      
  - Phi-2 verifier model for automated checking                                                                                                                                                                      
  - Layer scroll UX in dashboard                                                                                                                                                                                     
                                                                                                                                                                                                                     
  ---                                                                                                                                                                                                                
  Key Files to Read First                                                                                                                                                                                            
                                                                                                                                                                                                                     
  1. phi2_lab/geometry_viz/schema.py — understand data structures                                                                                                                                                    
  2. phi2_lab/geometry_viz/api.py — understand API surface                                                                                                                                                           
  3. phi2_lab/config/app.yaml — understand configuration                                                                                                                                                             
  4. phi2_lab/auth/api_keys.py — understand access control                                                                                                                                                           
  5. phi2_lab/geometry_viz/mock_data.py — understand synthetic data generation                                                                                                                                       
                                                                                                                                                                                                                     
  ---                                                                                                                                                                                                                
  Contact                                                                                                                                                                                                            
                                                                                                                                                                                                                     
  Project lives at: github.com/Everplay-Tech/PHILAB                                                                                                                                                                  
  Community: r/technopoets                     
